<!-- camera.html -->
<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">Camera</div>
            </div>
        </div>
        <div class="page-content block">
            <h1>Voorbeeld Camera</h1>

            <button
                class="col button button-raised button-red"
                @click="getphoto"
            >
                Take picture
            </button>
            <button
                class="col button button-raised button-red"
                @click="getphotolibrary"
            >
                PhotoLibrary
            </button>
            <hr />
            <div id="result">
                <img
                    id="imgPhoto"
                    src=""
                    class="responsive"
                    alt="hier komt de foto..."
                />
            </div>
        </div>
        <!-- /page-content -->
    </div>
</template>
<script>
    // 0. variabelen op deze pagina
    var db = window.localStorage;
    var fotoArray = [];

    // 1. De callback die wordt uitgevoerd als foto maken goed ging
    function cameraSuccess(data) {
        document.getElementById('imgPhoto').src = data;
    }

    // 2. de callback die wordt uitgevoerd als er een fout is opgetreden
    function cameraFail(error) {
        alert('Foto maken ging fout: ' + error);
    }

    // 3. De opties voor de camera. In eerste instantie alleen de standaardwaarden (=leeg object)
    var cameraOptions = {
        correctOrientation: true,
        cameraDirection: 1,
        saveToPhotoAlbum: true
    };

    function voegFotoToe(data) {
        var nieuweFoto = `
                 <p><img src="${data}" class="responsive"></p>
                <p>locatie: ${data}</p>
            `;
        $$('#result').append(nieuweFoto);
    }
    var $$ = Dom7;
    return {
        on: {
            pageInit: function() {
                var data = db.getItem('fotos');
                if (data) {
                    // er zijn al foto's gevonden
                    fotoArray = data.split(',');
                    fotoArray.forEach(function(foto) {
                        voegFotoToe(foto);
                    });
                } else {
                    $$('#result').text('maak uw eerste foto');
                }
            }
        },
        methods: {
            getphoto: function() {
                navigator.camera.getPicture(
                    cameraSuccess,
                    cameraFail,
                    cameraOptions
                );
            },
            getphotolibrary: function() {
                // Nieuwe opties, nu om foto uit de library te halen.
                var cameraOptionsLibrary = {
                    sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY,
                    correctOrientation: true
                };

                // Nieuwe success-functie, om meerdere foto's onder elkaar te plaatsen.
                function cameraSuccessLibrary(data) {
                    voegFotoToe(data);
                    // Toegevoegde foto opslaan in localStorage zodat je hem weer kunt laden als de
                    // pagina opnieuw wordt opgehaald.
                    // Ik maak hiervoor een nieuwe variabele  (van 'database')
                    fotoArray.push(data);
                    window.localStorage.setItem('fotos', fotoArray.toString());
                }
                navigator.camera.getPicture(
                    cameraSuccessLibrary,
                    cameraFail,
                    cameraOptionsLibrary
                );
            }
        }
    };
</script>
